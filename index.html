<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{font-family:Cairo;background:#eef1f4;margin:0;padding:10px}
h2{text-align:center}
.hidden{display:none}
input,button{width:100%;padding:8px;margin:5px 0}
.card{background:#fff;padding:10px;margin:8px 0;border-radius:8px}
img{width:70px;height:70px;border-radius:50%;object-fit:cover}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:6px;text-align:center}
button{background:#0a7cff;color:#fff;border:0;border-radius:6px}
</style>
</head>

<body>

<!-- ğŸ” LOGIN -->
<div id="login">
  <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
  <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯">
  <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- ğŸ“‹ APP -->
<div id="app" class="hidden">
<h2>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h2>

<form id="form">
  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°" required>
  <input id="subject" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø©" required>
  <input id="phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
  <input type="file" id="image">
  <button>ğŸ’¾ Ø­ÙØ¸</button>
</form>

<h3>ğŸ“‘ Ø§Ù„Ù„Ø§Ø¦Ø­Ø©</h3>
<div id="list"></div>

<h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ±</h3>
<table>
<thead>
<tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th></tr>
</thead>
<tbody id="report"></tbody>
</table>

<button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</div>

<script>
/* ğŸ”¥ Firebase */
firebase.initializeApp({
 apiKey:"AIzaSyBljZoIG9rTcz-kTX9o9CL8l3WvciZjyTY",
 authDomain:"chinguitt2718.firebaseapp.com",
 databaseURL:"https://chinguitt2718-default-rtdb.firebaseio.com",
 projectId:"chinguitt2718",
 storageBucket:"chinguitt2718.appspot.com"
});

const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();

let teachers=JSON.parse(localStorage.getItem("teachers"))||[];

/* ğŸ” AUTH */
auth.onAuthStateChanged(u=>{
 if(u){
   login.classList.add("hidden");
   app.classList.remove("hidden");
   loadFromFirebase();
 }else{
   app.classList.add("hidden");
   login.classList.remove("hidden");
 }
});

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .catch(e=>alert(e.message));
}
function logout(){auth.signOut();}

/* â˜ï¸ LOAD ONCE (Ù„Ø§ ØªØ®ØªÙÙŠ Ø§Ù„Ù„Ø§Ø¦Ø­Ø©) */
function loadFromFirebase(){
 db.ref("teachers").once("value",s=>{
  if(s.exists()){
    teachers=s.val();
    localStorage.setItem("teachers",JSON.stringify(teachers));
    render();
  }else{
    render();
  }
 });
}

/* ğŸ–¼ï¸ IMAGE */
async function upload(file,id){
 const ref=storage.ref("teachers/"+id+".jpg");
 await ref.put(file);
 return await ref.getDownloadURL();
}

/* ğŸ’¾ SAVE */
form.onsubmit=async e=>{
 e.preventDefault();
 const id=Date.now();
 let img="";
 if(image.files[0]) img=await upload(image.files[0],id);

 teachers.push({
   id,
   name:name.value,
   subject:subject.value,
   phone:phone.value,
   image:img
 });

 localStorage.setItem("teachers",JSON.stringify(teachers));
 if(navigator.onLine) db.ref("teachers").set(teachers);
 render();
 form.reset();
};

/* ğŸ–¥ï¸ RENDER */
function render(){
 list.innerHTML="";
 report.innerHTML="";
 teachers.forEach(t=>{
   list.innerHTML+=`
    <div class="card">
     ${t.image?`<img src="${t.image}"><br>`:""}
     <b>${t.name}</b><br>
     ${t.subject}<br>
     ${t.phone}
    </div>`;
   report.innerHTML+=`
    <tr><td>${t.name}</td><td>${t.subject}</td><td>${t.phone}</td></tr>`;
 });
}

/* ğŸŒ AUTO SYNC */
window.addEventListener("online",()=>{
 db.ref("teachers").set(teachers);
});
</script>

</body>
</html>
