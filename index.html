<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ù‡Ø¯ Ø´Ù†Ù‚ÙŠØ·</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: Arial;
  background: #f5f5f5;
  margin: 10px;
}
h2 {
  text-align: center;
  color: green;
}
input, textarea, button {
  width: 100%;
  padding: 8px;
  margin: 4px 0;
}
button {
  background: green;
  color: white;
  border: none;
  cursor: pointer;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  background: white;
}
th, td {
  border: 1px solid #ccc;
  padding: 5px;
  text-align: center;
}
img {
  width: 45px;
  height: 45px;
  border-radius: 50%;
}
.action-btn {
  background: #555;
  margin: 2px;
}
.delete {
  background: red;
}
</style>
</head>

<body>

<h2>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ù‡Ø¯ Ø´Ù†Ù‚ÙŠØ·</h2>

<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°">
<input id="birthDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
<input id="birthPlace" placeholder="Ù…Ø­Ù„ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
<input id="nationalId" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ">
<input id="joinDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚">
<input id="branch" placeholder="Ø§Ù„ÙØ±Ø¹">
<input id="skill" placeholder="Ø§Ù„ÙƒÙØ§Ø¡Ø©">
<textarea id="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø©"></textarea>
<input type="file" id="image">

<button onclick="saveTeacher()">Ø­ÙØ¸</button>

<hr>

<input placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ" onkeyup="search(this.value)">
<button onclick="exportAllPdf()">ØªØµØ¯ÙŠØ± PDF</button>

<table>
<thead>
<tr>
<th>#</th>
<th>Ø§Ù„ØµÙˆØ±Ø©</th>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ø±Ù‚Ù…</th>
<th>Ø§Ù„ÙØ±Ø¹</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<script>
// ğŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBljZoIG9rTcz-kTX9o9CL8l3WvciZjyTY",
  authDomain: "chinguitt2718.firebaseapp.com",
  databaseURL: "https://chinguitt2718-default-rtdb.firebaseio.com",
  projectId: "chinguitt2718",
  storageBucket: "chinguitt2718.firebasestorage.app"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const teachersRef = db.ref("teachers");

// ğŸ“¦ Data
let teachers = [];
let editIndex = null;

// ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© + Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ©
teachersRef.on("value", snap => {
  teachers = snap.val() || [];
  localStorage.setItem("teachers_backup", JSON.stringify(teachers));
  render();
});

// ğŸ’¾ Ø­ÙØ¸
function saveTeacher() {
  const reader = new FileReader();
  const img = image.files[0];

  reader.onload = () => {
    const data = {
      name: name.value,
      birthDate: birthDate.value,
      birthPlace: birthPlace.value,
      nationalId: nationalId.value,
      joinDate: joinDate.value,
      branch: branch.value,
      skill: skill.value,
      note: note.value,
      image: reader.result || ""
    };

    if (editIndex !== null) {
      teachers[editIndex] = data;
      editIndex = null;
    } else {
      teachers.push(data);
    }

    teachersRef.set(teachers);
    clearForm();
  };

  img ? reader.readAsDataURL(img) : reader.onload();
}

// ğŸ“‹ Ø¹Ø±Ø¶
function render(list = teachers) {
  listElem.innerHTML = "";
  list.forEach((t, i) => {
    listElem.innerHTML += `
    <tr>
      <td>${i + 1}</td>
      <td><img src="${t.image}"></td>
      <td>${t.name}</td>
      <td>${t.nationalId}</td>
      <td>${t.branch}</td>
      <td>
        <button class="action-btn" onclick="edit(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="action-btn delete" onclick="del(${i})">Ø­Ø°Ù</button>
        <button class="action-btn" onclick="singlePdf(${i})">PDF</button>
      </td>
    </tr>`;
  });
}

// âœ ØªØ¹Ø¯ÙŠÙ„
function edit(i) {
  const t = teachers[i];
  name.value = t.name;
  birthDate.value = t.birthDate;
  birthPlace.value = t.birthPlace;
  nationalId.value = t.nationalId;
  joinDate.value = t.joinDate;
  branch.value = t.branch;
  skill.value = t.skill;
  note.value = t.note;
  editIndex = i;
}

// âŒ Ø­Ø°Ù
function del(i) {
  if (confirm("Ø­Ø°Ù Ø§Ù„Ø£Ø³ØªØ§Ø°ØŸ")) {
    teachers.splice(i, 1);
    teachersRef.set(teachers);
  }
}

// ğŸ” Ø¨Ø­Ø«
function search(v) {
  render(
    teachers.filter(t =>
      t.name.includes(v) || t.nationalId.includes(v)
    )
  );
}

// ğŸ“„ PDF
function exportAllPdf() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  let y = 20;
  pdf.text("Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ù‡Ø¯ Ø´Ù†Ù‚ÙŠØ·", 70, 10);
  teachers.forEach((t, i) => {
    pdf.text(`${i+1}- ${t.name} | ${t.nationalId}`, 10, y);
    y += 8;
  });
  pdf.save("teachers.pdf");
}

function singlePdf(i) {
  const { jsPDF } = window.jspdf;
  const t = teachers[i];
  const pdf = new jsPDF();
  pdf.text("ØªÙ‚Ø±ÙŠØ± Ø£Ø³ØªØ§Ø°", 80, 10);
  pdf.text("Ø§Ù„Ø§Ø³Ù…: " + t.name, 10, 30);
  pdf.text("Ø§Ù„Ø±Ù‚Ù…: " + t.nationalId, 10, 40);
  pdf.text("Ø§Ù„ÙØ±Ø¹: " + t.branch, 10, 50);
  pdf.save(t.name + ".pdf");
}

function clearForm() {
  document.querySelectorAll("input, textarea").forEach(e => e.value = "");
}

const listElem = document.getElementById("list");
</script>

</body>
</html>
