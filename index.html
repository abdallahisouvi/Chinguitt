<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ù‡Ø¯ Ø´Ù†Ù‚ÙŠØ·</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: Arial;
  background: #f4f6f7;
  margin: 10px;
}
h2,h3 { text-align:center; color:#1e8449 }
input, textarea, button {
  width:100%; padding:8px; margin:4px 0;
}
button {
  background:#1e8449; color:white; border:none; cursor:pointer;
}
table {
  width:100%; border-collapse:collapse; margin-top:10px; background:white;
}
th,td {
  border:1px solid #ccc; padding:6px; text-align:center;
}
img {
  width:45px; height:45px; border-radius:50%;
}
.action-btn { background:#555; margin:2px }
.delete { background:#c0392b }
#loginBox {
  max-width:400px; margin:80px auto; background:white;
  padding:20px; border-radius:8px;
}
#app { display:none }
</style>
</head>

<body>

<!-- ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginBox">
  <h3>Ø¯Ø®ÙˆÙ„ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯</h3>
  <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
  <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- ğŸ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<div id="app">

<h2>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹Ù‡Ø¯ Ø´Ù†Ù‚ÙŠØ·</h2>

<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°">
<input id="birthDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
<input id="birthPlace" placeholder="Ù…Ø­Ù„ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯">
<input id="nationalId" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ">
<input id="joinDate" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚">
<input id="branch" placeholder="Ø§Ù„ÙØ±Ø¹">
<input id="skill" placeholder="Ø§Ù„ÙƒÙØ§Ø¡Ø©">
<textarea id="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
<input type="file" id="image">

<button onclick="saveTeacher()">Ø­ÙØ¸</button>

<hr>

<input placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ" onkeyup="search(this.value)">
<button onclick="exportAllPdf()">ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© PDF</button>

<table>
<thead>
<tr>
<th>#</th>
<th>Ø§Ù„ØµÙˆØ±Ø©</th>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ø±Ù‚Ù…</th>
<th>Ø§Ù„ÙØ±Ø¹</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

</div>

<script>
// ğŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBljZoIG9rTcz-kTX9o9CL8l3WvciZjyTY",
  authDomain: "chinguitt2718.firebaseapp.com",
  databaseURL: "https://chinguitt2718-default-rtdb.firebaseio.com",
  projectId: "chinguitt2718",
  storageBucket: "chinguitt2718.firebasestorage.app"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const auth = firebase.auth();
const storage = firebase.storage();
const teachersRef = db.ref("teachers");

// ğŸ” Auth
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .catch(e=>alert(e.message));
}

auth.onAuthStateChanged(user=>{
  loginBox.style.display = user ? "none":"block";
  app.style.display = user ? "block":"none";
});

// ğŸ“¦ Data
let teachers = [];
let editIndex = null;

// ğŸ”„ Sync + Backup
teachersRef.on("value",snap=>{
  teachers = snap.val() || [];
  localStorage.setItem("teachers_backup",JSON.stringify(teachers));
  render();
});

// ğŸ“¸ Upload Image
async function uploadImage(file,id){
  const ref = storage.ref("teachers/"+id+".jpg");
  await ref.put(file);
  return await ref.getDownloadURL();
}

// ğŸ’¾ Save
async function saveTeacher(){
  const id = editIndex ?? Date.now();
  let imageUrl = "";

  if(image.files[0]){
    imageUrl = await uploadImage(image.files[0],id);
  } else if(editIndex !== null){
    imageUrl = teachers[editIndex].image;
  }

  const data = {
    id,
    name:name.value,
    birthDate:birthDate.value,
    birthPlace:birthPlace.value,
    nationalId:nationalId.value,
    joinDate:joinDate.value,
    branch:branch.value,
    skill:skill.value,
    note:note.value,
    image:imageUrl
  };

  if(editIndex !== null){
    teachers[editIndex]=data;
    editIndex=null;
  } else {
    teachers.push(data);
  }

  teachersRef.set(teachers);
  clearForm();
}

// ğŸ“‹ Render
function render(list=teachers){
  listElem.innerHTML="";
  list.forEach((t,i)=>{
    listElem.innerHTML+=`
    <tr>
      <td>${i+1}</td>
      <td><img src="${t.image||''}"></td>
      <td>${t.name}</td>
      <td>${t.nationalId}</td>
      <td>${t.branch}</td>
      <td>
        <button class="action-btn" onclick="edit(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="action-btn delete" onclick="del(${i})">Ø­Ø°Ù</button>
        <button class="action-btn" onclick="singlePdf(${i})">PDF</button>
      </td>
    </tr>`;
  });
}

// âœ Edit
function edit(i){
  const t=teachers[i];
  name.value=t.name;
  birthDate.value=t.birthDate;
  birthPlace.value=t.birthPlace;
  nationalId.value=t.nationalId;
  joinDate.value=t.joinDate;
  branch.value=t.branch;
  skill.value=t.skill;
  note.value=t.note;
  editIndex=i;
}

// âŒ Delete
function del(i){
  if(confirm("Ø­Ø°Ù Ø§Ù„Ø£Ø³ØªØ§Ø°ØŸ")){
    teachers.splice(i,1);
    teachersRef.set(teachers);
  }
}

// ğŸ” Search
function search(v){
  render(teachers.filter(t=>t.name.includes(v)||t.nationalId.includes(v)));
}

// ğŸ“„ PDF All
function exportAllPdf(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  let y=20;
  pdf.text("Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ø§ØªØ°Ø© Ù…Ø¹Ù‡Ø¯ Ø´Ù†Ù‚ÙŠØ·",60,10);
  teachers.forEach((t,i)=>{
    pdf.text(`${i+1}- ${t.name} | ${t.nationalId}`,10,y);
    y+=8;
  });
  pdf.save("teachers.pdf");
}

// ğŸ§¾ PDF Single (Ø§Ø­ØªØ±Ø§ÙÙŠ)
function singlePdf(i){
  const {jsPDF}=window.jspdf;
  const t=teachers[i];
  const pdf=new jsPDF();

  pdf.addImage("assets/logo.png","PNG",80,5,50,20);
  pdf.text("ØªÙ‚Ø±ÙŠØ± Ø£Ø³ØªØ§Ø° â€“ Ù…Ø¹Ù‡Ø¯ Ø´Ù†Ù‚ÙŠØ·",55,30);

  let y=45;
  [
    ["Ø§Ù„Ø§Ø³Ù…",t.name],
    ["ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯",t.birthDate],
    ["Ù…Ø­Ù„ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯",t.birthPlace],
    ["Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ",t.nationalId],
    ["ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù„ØªØ­Ø§Ù‚",t.joinDate],
    ["Ø§Ù„ÙØ±Ø¹",t.branch],
    ["Ø§Ù„ÙƒÙØ§Ø¡Ø©",t.skill],
    ["Ù…Ù„Ø§Ø­Ø¸Ø§Øª",t.note]
  ].forEach(r=>{
    pdf.text(r[0]+" : "+r[1],10,y);
    y+=8;
  });

  if(t.image){
    pdf.addImage(t.image,"JPEG",150,45,40,40);
  }

  pdf.save("ØªÙ‚Ø±ÙŠØ±_"+t.name+".pdf");
}

// ğŸ§¹ Clear
function clearForm(){
  document.querySelectorAll("input,textarea").forEach(e=>e.value="");
}

const listElem=document.getElementById("list");
</script>

</body>
</html>
