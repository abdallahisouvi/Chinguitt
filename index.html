<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{font-family:Cairo;background:#f4f6f8;margin:0;padding:10px}
h2{text-align:center}
form,input,button{width:100%;margin:5px 0;padding:8px}
.card{background:#fff;padding:10px;margin:8px 0;border-radius:8px}
img{max-width:80px;border-radius:50%}
</style>
</head>

<body>

<h2>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h2>

<form id="teacherForm">
<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°" required>
<input id="subject" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø©" required>
<input id="phone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ">
<input type="file" id="image">
<button type="submit">ğŸ’¾ Ø­ÙØ¸</button>
</form>

<div id="list"></div>

<script>
/* ğŸ”¥ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyBljZoIG9rTcz-kTX9o9CL8l3WvciZjyTY",
  authDomain: "chinguitt2718.firebaseapp.com",
  databaseURL: "https://chinguitt2718-default-rtdb.firebaseio.com",
  projectId: "chinguitt2718",
  storageBucket: "chinguitt2718.appspot.com"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const storage = firebase.storage();

let teachers = JSON.parse(localStorage.getItem("teachers")) || [];

/* ğŸ§  Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ */
function saveLocal(){
  localStorage.setItem("teachers", JSON.stringify(teachers));
}

/* â˜ï¸ Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase */
function syncFirebase(){
  if(!navigator.onLine) return;
  db.ref("teachers").set(teachers);
}

/* ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù† Firebase (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·) */
db.ref("teachers").once("value", snap=>{
  if(snap.exists()){
    teachers = snap.val();
    saveLocal();
    render();
  }
});

/* ğŸ–¼ï¸ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© */
async function uploadImage(file,id){
  const ref = storage.ref("teachers/"+id+".jpg");
  await ref.put(file);
  return await ref.getDownloadURL();
}

/* ğŸ’¾ Ø­ÙØ¸ Ø£Ø³ØªØ§Ø° */
document.getElementById("teacherForm").onsubmit = async e =>{
  e.preventDefault();

  const id = Date.now();
  let imgUrl = "";

  const file = image.files[0];
  if(file) imgUrl = await uploadImage(file,id);

  const teacher = {
    id,
    name: name.value,
    subject: subject.value,
    phone: phone.value,
    image: imgUrl
  };

  teachers.push(teacher);
  saveLocal();
  syncFirebase();
  render();
  e.target.reset();
};

/* ğŸ–¥ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
function render(){
  const list = document.getElementById("list");
  list.innerHTML = "";
  teachers.forEach(t=>{
    list.innerHTML += `
      <div class="card">
        ${t.image ? `<img src="${t.image}">` : ""}
        <b>${t.name}</b><br>
        ğŸ“˜ ${t.subject}<br>
        ğŸ“ ${t.phone}
      </div>
    `;
  });
}

render();

/* ğŸŒ Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ Ø¹ÙˆØ¯Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª */
window.addEventListener("online", syncFirebase);
</script>

</body>
</html>
